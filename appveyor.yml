version: "{branch} {build}"

image: Visual Studio 2017

environment:
  JAVA_HOME: C:\jdk11
  APPVEYOR_CACHE_ENTRY_ZIP_ARGS: "-t7z -m0=lzma -mx=9"

shallow_clone: true

build_script:
  - ps: |
      $client = New-Object net.webclient
      $client.DownloadFile('http://jdk.java.net/11/', 'C:\Users\appveyor\openjdk11.html')
      $openJdk11 = cat C:\Users\appveyor\openjdk11.html | where { $_ -match "href.*https://download.java.net.*jdk11.*windows-x64.*zip\`"" } | %{ $_ -replace "^.*https:", "https:" } | %{ $_ -replace ".zip\`".*$", ".zip" }
      echo "Download boot JDK from: $openJdk11"
      $client.DownloadFile($openJdk11, 'C:\Users\appveyor\openjdk11.zip')
      Expand-Archive -Path 'C:\Users\appveyor\openjdk11.zip' -DestinationPath 'C:\Users\appveyor\openjdk11'
      Copy-Item -Path 'C:\Users\appveyor\openjdk11\*\' -Destination 'C:\jdk11' -Recurse -Force
      C:\Users\appveyor\openjdk11\jdk-11\bin\java -version
      echo "SKIPPING: .\tools\scripts\build.ps1"

on_finish:
  - ps: |
      echo "on finish called"

on_success:
  - ps: |
      echo "on success called"

cache:
  - C:\Users\appveyor\.gradle\caches
  - C:\Users\appveyor\.gradle\wrapper -> gradle\wrapper\gradle-wrapper.properties
  - '%JAVA_HOME% -> appveyor.yml'
  - C:\ProgramData\chocolatey\bin -> appveyor.yml
  - C:\ProgramData\chocolatey\lib -> appveyor.yml
  - C:\ProgramData\chocolatey\cache -> appveyor.yml
  - C:\MSSymbols -> appveyor.yml

